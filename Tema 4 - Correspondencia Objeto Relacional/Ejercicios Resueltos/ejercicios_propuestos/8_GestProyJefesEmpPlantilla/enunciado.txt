8. Considera la distinción de empleados en plantilla frente a empleados no en plantilla, que se contratan para proyectos determinados. Solo los empleados en plantilla pueden ser jefes de proyecto. El siguiente esquema E-R describe este cambio.
Se creará una nueva tabla emp_plantilla para los empleados en plantilla, incluyendo un campo dni y con una clave foránea por este campo hacia empleado . A los empleados en plantilla se les asigna un número de empleado que sirve como identificación para ellos, que será clave primaria y a la que la base de datos asignará un nuevo valor automáticamente al insertar una nueva fi la en la tabla. La relación entre empleados y empleados en plantilla es una relación jerárquica, que se implementa en Java con una nueva clase EmpPlantilla subclase de la actual Empleado . Se pide hacer una copia de la base de datos y una copia del proyecto para ORM desarrollado hasta ahora, que funcionará con la nueva base de datos, y desarrollar la actividad a partir de esta copia. Se pide hacer los cambios necesarios en la estructura de la base de datos, hacer las conversiones de datos necesarias, hacer los cambios necesarios en el proyecto, tanto en las clases como en los ficheros de
correspondencia, y crear un programa de prueba en el método main() de una nueva clase.
El primer paso será hacer los cambios de estructura y la conversión de datos en la nueva base de datos. Todos los empleados existentes se considerarán empleados en plantilla. Una vez creada la nueva tabla emp_plantilla, se tiene que insertar en ella una fila por empleado, con una sentencia INSERT INTO emp_plantilla(...) SELECT ... FROM empleado . La clave foránea de proyecto a empleado debe cambiarse a emp_plantilla . Para ello debe crearse un nuevo campo num_emp_jefe_proy en proyecto, asignarle el valor apropiado en base al valor del campo dni (con una sentencia UPDATE proyecto p SET num_emp_jefe_proy=(SELECT e.num_emp FROM emp_plantilla e WHERE ...)), crear la nueva clave foránea (ALTER TABLE ... ADD CONSTRAINT ...), y por último, borrar la antigua clave foránea a empleado (ALTER TABLE ... DROP CONSTRAINT ...) y el campo dni_jefe_proy (ALTER TABLE ... DROP COLUMN ...). Eso es todo en lo que respecta a la conversión de datos. Después habrá que crear la nueva clase EmpPlantilla como subordinada de Empleado, y la nueva correspondencia para la clase Empleado en conjunto con EmpleadoPlantilla.